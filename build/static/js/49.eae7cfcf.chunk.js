(this["webpackJsonpdatta-able-rv18.0.4"]=this["webpackJsonpdatta-able-rv18.0.4"]||[]).push([[49],{317:function(e,t,a){"use strict";var l=a(0),n=a.n(l),s=a(242),i=a.n(s);class d extends l.Component{constructor(e){super(e),console.log("data in excel",e.dataSource)}render(){return console.log(this.props),n.a.createElement("div",null,n.a.createElement("table",{id:"matter",className:"d-none"},n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",null,"S.No"),n.a.createElement("th",null,"Last Seen"),n.a.createElement("th",null,"Status"),n.a.createElement("th",null,"Due Date"),n.a.createElement("th",null,"ID"),n.a.createElement("th",null,"Client"),n.a.createElement("th",null,"Matter"),n.a.createElement("th",null,"Issue Date"),n.a.createElement("th",null,"Balance"))),n.a.createElement("tbody",null,this.props.dataSource.map((e,t)=>n.a.createElement("tr",{key:t},n.a.createElement("td",null,t+1),n.a.createElement("td",null,e.lastSeen),n.a.createElement("td",null,e.status),n.a.createElement("th",null,e.dueDate),n.a.createElement("th",null,e.id),n.a.createElement("th",null,e.client),n.a.createElement("th",null,e.matter),n.a.createElement("th",null,e.issueDate),n.a.createElement("th",null,e.balance))))),n.a.createElement(i.a,{className:"btn btn-outline-primary btn-sm excel-button",table:"matter",filename:"Bills",sheet:"Sheet",buttonText:"Export to Excel"}))}}t.a=d},589:function(e,t,a){"use strict";a.r(t);var l=a(0),n=a.n(l),s=a(946),i=a(975),d=a(110),r=a(1004),c=a(268),o=a(153),m=a(1001),u=a(989),h=a(996),b=a(999),p=a(230),E=a.n(p),D=(a(231),a(3)),y=a(8),k=a(317);const I=s.a.TabPane;class x extends n.a.Component{constructor(){super(),this.handelBills=e=>{"record"===e&&this.props.history.push("/manage/billing/record")},this.state={tableData:[],draftBills:[],unpaidBills:[],paidBills:[],status:!1,loading:!0,visible:!1,disable:!1,emailAddress:"",imageFile:{}}}cancel(e){i.a.error("Canceled")}componentDidMount(){D.b.get("/billing/bill/viewforuser/"+this.props.userId).then(e=>{console.log(e.data.data);let t=[],a=[],l=[],n=[];e.data.data.map((e,s)=>{console.log({testttt:e.client});const i={key:s,_id:e._id,lastSeen:e.lastSeen?e.lastSeen.substring(0,10):"-",status:e.status,dueDate:e.dueDate.substring(0,10),id:e.invoiceId?e.invoiceId:"-",client:e.client?e.client.firstName+" "+e.client.lastName:"-",matter:e.matter?e.matter.matterDescription:"-",emailAddress:e.client.emailAddress[0]?e.client.emailAddress[0].emailAddress:"",issueDate:e.issueDate.substring(0,10),balance:parseFloat(e.balance).toFixed("2")};"Paid"==e.status&&a.push(i),"Unpaid"==e.status&&l.push(i),"draft"==e.status&&n.push(i),t.push(i)}),this.setState({tableData:t,paidBills:a,unpaidBills:l,draftBills:n,loading:!1})})}render(){const e=(e,t)=>{const a=e;delete a.matter,delete a.client,"fromDraft"===t?a.status="Unpaid":"fromUnpaid"===t&&(a.status="Paid"),D.b.post("/billing/bill/edit/"+e._id,a).then(a=>{if(console.log(a),"fromDraft"==t){const t=this.state;t.draftBills.splice(e.key,1),t.unpaidBills.push(a.data.data)}if("fromUnpaid"==t){const t=this.state;t.unpaidBills.splice(e.key,1),t.paidBills.push(a.data.data)}d.a.success({message:"Success"}),setTimeout(()=>{this.componentDidMount()},1e3)}).catch(e=>{console.log(e),d.a.error("Failed")})},t=e=>{D.b.get("/billing/bill/delete/"+e._id).then(e=>{console.log(e),this.componentDidMount(),d.a.success({message:"Bills Deleted !"}),setTimeout(()=>{},1500)}).catch(e=>{d.a.error({message:"Failed to delete"})})},a=[{title:"Action",dataIndex:"action",key:"action",render:(t,a)=>n.a.createElement(r.a,{title:"Approve this draft bill",onConfirm:()=>e(a,"fromDraft"),onCancel:this.cancel,okText:"Yes",cancelText:"No"},n.a.createElement(b.a.Check,{type:"checkbox"}))},{title:"Last Seen",dataIndex:"lastSeen",key:"lastSeen"},{title:"Status",dataIndex:"status",key:"status"},{title:"Due Date",dataIndex:"dueDate",key:"dueDate"},{title:"ID",dataIndex:"id",key:"id"},{title:"Client",dataIndex:"client",key:"client"},{title:"Matter",dataIndex:"matter",key:"matter"},{title:"Issue Date",dataIndex:"issueDate",key:"issueDate"},{title:"Balance",dataIndex:"balance",key:"balance"},{title:"SendInvoice",dataIndex:"SendInvoice",key:"send",render:(e,t)=>n.a.createElement(c.a,{onClick:()=>{this.setState({visible:!0,emailAddress:t.emailAddress})}},"Send Invoice")},{title:"Delete",dataIndex:"Delete",key:"Delete",render:(e,a)=>n.a.createElement(r.a,{title:"Are you sure you want to delete this bill ?",onConfirm:()=>t(a),onCancel:this.cancel,okText:"Yes",cancelText:"No"},n.a.createElement(c.a,{danger:!0},"Delete"))}],l=[{title:"Action",dataIndex:"action",key:"action",render:(t,a)=>n.a.createElement(r.a,{title:"Mark as Paid",onConfirm:()=>e(a,"fromUnpaid"),onCancel:this.cancel,okText:"Yes",cancelText:"No"},n.a.createElement(b.a.Check,{type:"checkbox"}))},{title:"Last Seen",dataIndex:"lastSeen",key:"lastSeen"},{title:"Status",dataIndex:"status",key:"status"},{title:"Due Date",dataIndex:"dueDate",key:"dueDate"},{title:"ID",dataIndex:"id",key:"id"},{title:"Client",dataIndex:"client",key:"client"},{title:"Matter",dataIndex:"matter",key:"matter"},{title:"Issue Date",dataIndex:"issueDate",key:"issueDate"},{title:"Balance",dataIndex:"balance",key:"balance"},{title:"SendInvoice",dataIndex:"SendInvoice",key:"send",render:(e,t)=>n.a.createElement(c.a,{onClick:()=>{this.setState({visible:!0,emailAddress:t.emailAddress})}},"Send Invoice")},{title:"Delete",dataIndex:"Delete",key:"Delete",render:(e,a)=>n.a.createElement(r.a,{title:"Are you sure you want to delete this bill ?",onConfirm:()=>t(a),onCancel:this.cancel,okText:"Yes",cancelText:"No"},n.a.createElement(c.a,{danger:!0},"Delete"))}],i=[{title:"Last Seen",dataIndex:"lastSeen",key:"lastSeen"},{title:"Status",dataIndex:"status",key:"status"},{title:"Due Date",dataIndex:"dueDate",key:"dueDate"},{title:"ID",dataIndex:"id",key:"id"},{title:"Client",dataIndex:"client",key:"client"},{title:"Matter",dataIndex:"matter",key:"matter"},{title:"Issue Date",dataIndex:"issueDate",key:"issueDate"},{title:"Balance",dataIndex:"balance",key:"balance"},{title:"SendInvoice",dataIndex:"SendInvoice",key:"send",render:(e,t)=>n.a.createElement(c.a,{onClick:()=>{this.setState({visible:!0,emailAddress:t.emailAddress})}},"Send Invoice")},{title:"Delete",dataIndex:"Delete",key:"Delete",render:(e,a)=>n.a.createElement(r.a,{title:"Are you sure you want to delete this bill ?",onConfirm:()=>t(a),onCancel:this.cancel,okText:"Yes",cancelText:"No"},n.a.createElement(c.a,{danger:!0},"Delete"))}],p=()=>{if(d.a.destroy(),this.state.imageFile==={})d.a.warning({message:"Please upload a document"});else{this.setState({disable:!0});var e=new FormData;e.set("image",this.state.imageFile),D.b.post("/footer/upload",e,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{console.log(e),d.a.success({message:"Sending Email..."});let t={to:this.state.emailAddress,subject:"Invoice",text:e.data.message,date:new Date};console.log(t),D.b.post("/communication/sendemail",t).then(e=>{console.log(e),this.setState({disable:!1,visible:!1}),d.a.success({message:"Invoice sent"})})}).catch(e=>{console.log(e),this.setState({disable:!1,visible:!1}),d.a.error({message:"Try again later."})})}};return n.a.createElement(o.a,{size:"large",spinning:this.state.loading},n.a.createElement("div",{className:"p-2 "},n.a.createElement("div",{className:"d-flex mb-2 title-component-header"},n.a.createElement("div",{className:"title-header-name"},n.a.createElement("h5",null,"Billing")),n.a.createElement("div",{className:"d-flex extra-iteam-div"},n.a.createElement("button",{className:"btn  btn-outline-primary   btn-sm",onClick:()=>{const e=new E.a("portrait","pt","A4");e.setFontSize(15);let t=[];this.state.tableData.map((e,a)=>{const l=[e.lastSeen,e.status,e.dueDate,e.id,e.client,e.matter,e.issueDate,e.balance];t.push(l)});let a={startY:50,head:[["Last Seen","Status","Due Date","ID","Client","Matter","Issue Date","Balance"]],body:t};e.text("Bills",40,40),e.autoTable(a),e.save("Bill.pdf")}},"Export to Pdf"),n.a.createElement(k.a,{dataSource:this.state.tableData||[]}),n.a.createElement("button",{className:"btn  btn-outline-primary   btn-sm",onClick:()=>this.handelBills("record")},"Record Payment"),n.a.createElement("button",{className:"btn  btn-outline-primary   btn-sm",onClick:()=>this.props.history.push("/create/bills")},"New Bills"))),n.a.createElement(m.a,null,n.a.createElement(s.a,{defaultActiveKey:"4",onChange:()=>{}},n.a.createElement(I,{tab:"Draft",key:"1"},n.a.createElement(u.a,{className:"table-responsive",dataSource:this.state.draftBills,columns:a})),n.a.createElement(I,{tab:"All",key:"4"},n.a.createElement(u.a,{className:"table-responsive",dataSource:this.state.tableData,columns:i})),n.a.createElement(I,{tab:"Unpaid",key:"3"},n.a.createElement(u.a,{className:"table-responsive",dataSource:this.state.unpaidBills,columns:l})),n.a.createElement(I,{tab:"Paid",key:"2"},n.a.createElement(u.a,{className:"table-responsive",dataSource:this.state.paidBills,columns:i})))),n.a.createElement(h.a,{title:"Send Invoice",visible:this.state.visible,onCancel:()=>{this.setState({visible:!1})},onOk:p,footer:[n.a.createElement(c.a,{onClick:()=>{this.setState({visible:!1})}},"Cancel"),n.a.createElement(c.a,{type:"primary",disabled:this.state.disable,onClick:p},"Send")]},n.a.createElement(b.a,{id:"myForm",className:"form",className:"form-details"},n.a.createElement(b.a.Group,{controlId:"formGroupEmail"},n.a.createElement("input",{type:"file",name:"File",onChange:e=>{this.setState({imageFile:e.target.files[0]})},placeholder:"Upload Image"}))))))}}t.default=Object(y.b)(e=>({userId:e.user.token.user._id}))(x)}}]);
//# sourceMappingURL=49.eae7cfcf.chunk.js.map