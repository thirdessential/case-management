(this["webpackJsonpdatta-able-rv18.0.4"]=this["webpackJsonpdatta-able-rv18.0.4"]||[]).push([[63],{598:function(e,t,a){"use strict";a.r(t);var l=a(225),s=a.n(l),i=a(226),n=a(0),c=a.n(n),r=a(999),o=a(950),d=a(110),m=a(268),u=a(989),h=a(996),p=a(8),b=a(3),v=a(230),E=a.n(v);a(231),a(595);class g extends c.a.Component{constructor(){super(),this.state={data:{billable:!1,qty:"1.0",date:"",rate:"",invoice:"Unbilled"},dates:{issueDate:"",dueDate:""},tableData:[],record:"",name:"",Matter:"",LName:"",touched:!0,selected:[],visible:!1,disable:!1,invoice:{},invoiceId:0,userData:""}}componentDidMount(){b.b.get("/user/view/"+this.props.userId).then(e=>{console.log({res:e}),this.setState({userData:e.data.data})}).catch(e=>{console.log({error:e})}),console.log({mounted:this.state.userData});let e=0;b.b.get("/billing/bill/showall").then(t=>{console.log(t),e=t.data.data.length+1,this.setState({invoiceId:t.data.data.length+1}),b.b.get("/activity/viewforbill/"+this.props.userId).then(t=>{console.log(t);let a=[],l=[],s=0;void 0!==t.data.c&&Object.keys(t.data.c).map((function(i,n){let c=t.data.c[i][0],r={key:s,total:0,index:n,type:c.type,invoiceId:e+1,hours:"time"===c.type?c.time:c.qty,client:c.matter?c.matter.client.firstName+" "+c.matter.client.lastName:"-",clientId:c.matter?c.matter.client._id:"",emailAddress:c.matter.client.emailAddress[0]?c.matter.client.emailAddress[0].emailAddress:"",matter:c.matter._id,matterDescription:c.matter.matterDescription,rate:c.rate,billable:c.billable?"Yes":"No",invoiceStatus:"Unbilled",trustAmount:"$0.00",activity:[]};t.data.c[i].map((e,t)=>{r.activity.push(e._id);let a="",l="",s="",i=parseFloat(e.rate);if(0==e.billed&&1==e.billable){"time"===e.type&&void 0!=e.time&&(a=parseInt(e.time.split(":")[0]),l=parseInt(e.time.split(":")[1]),s=parseInt(e.time.split(":")[2]));let t="time"===e.type?i*a+i/60*l+i/3600*s:i*parseInt(e.qty);r.total=parseFloat(r.total)+parseFloat(t),r.total=r.total.toFixed("2")}}),0!=r.total&&(l.push(!1),e++,s++,a.push(r))})),this.setState({tableData:a}),console.log(a)})});const t=window.localStorage.getItem("timer");let a=Math.floor(t/3600),l=Math.floor(t/60);l>=59&&(l%=60);const s=this.state.data;s.time=a+":"+l,this.setState({data:s,touched:!0}),console.log(this.state)}render(){var e=this;const t=e=>{console.log(e.key);let t=this.state.selected;t[e.key]=!t[e.key],this.setState({selected:t}),console.log(this.state.selected)},a=[{title:"Action",dataIndex:"action",key:"action",render:(e,a)=>c.a.createElement(r.a.Check,{type:"checkbox",onChange:()=>t(a)})},{title:"Client",dataIndex:"client",key:"client"},{title:"Unbilled hours",dataIndex:"hours",key:"hours"},{title:"Amount Due",dataIndex:"total",key:"total"}],l=()=>{this.setState({visible:!1})},n=e=>{const t=e.target,a=t.value,l=t.name;let s=this.state.dates;s[l]=a,this.setState({dates:s})},p=()=>{console.log("pdf");var e=document.getElementById("canvas"),t=new E.a("p","mm","a4");t.addHTML(e,(function(){t.save("invoice.pdf")}))},v=()=>{d.a.destroy();let t=!0;if(""===this.state.dates.issueDate?(t=!1,d.a.warning({message:"Please select a issue date."})):""===this.state.dates.dueDate&&(t=!1,d.a.warning({message:"Please select a due date."})),t){this.setState({disable:!0});let t=[];this.state.tableData.map((e,a)=>{this.state.selected[a]&&t.push(e)}),t.map((t,a)=>{this.setState({invoice:t}),setTimeout(Object(i.a)(s.a.mark((function a(){var l,i;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,p();case 2:l=a.sent,console.log(l),i={userId:e.props.userId,status:"draft",invoiceId:t.invoiceId,name:t.client,client:t.clientId,matter:t.matter,issueDate:e.state.dates.issueDate,dueDate:e.state.dates.dueDate,balance:t.total},console.log(i),b.b.post("/billing/bill/create",i).then(a=>{t.billed=!0,console.log(a),t.activity.map(a=>{b.b.post("/activity/edit/"+a,t).then(t=>{console.log(t),e.setState({disableExpense:!1,disabletime:!1})})}),d.a.success({message:"Bill Generated!"}),e.setState({visible:!1,disable:!1}),e.props.history.goBack()}).catch(e=>{d.a.error({message:"Failure"})});case 7:case"end":return a.stop()}}),a)}))),1e3)})}};return console.log({render:this.state}),c.a.createElement("div",null,c.a.createElement(o.a,{id:"canvas",bodyStyle:{padding:"100px"},className:"mb-3"},c.a.createElement("div",{id:"divToPrint",className:"text-center P-3"},c.a.createElement("div",{className:"text-right"},console.log("invoice",this.state.invoice),c.a.createElement("h5",{className:"font-weight-bold"},"INVOICE"),c.a.createElement("div",null,c.a.createElement("div",null,"Invoice #",this.state.invoice.invoiceId),c.a.createElement("div",null,"Date : ",this.state.dates.issueDate))),c.a.createElement("div",{className:"float-left text-left"},c.a.createElement("div",null,c.a.createElement("h3",{style:{fontWeight:"bold"}},this.state.invoice.client," ")),c.a.createElement("div",null,c.a.createElement("span",{style:{fontWeight:"bold"}},this.state.invoice.emailAddress),c.a.createElement("br",null)),c.a.createElement("br",null),c.a.createElement("br",null)),c.a.createElement("div",{className:"my-5 py-5"},c.a.createElement("table",{class:"table"},c.a.createElement("thead",{class:"thead-light"},c.a.createElement("tr",null,c.a.createElement("th",{scope:"col"},"Issue Date"),c.a.createElement("th",{scope:"col"},"Due Date"),c.a.createElement("th",{scope:"col"},"Amount"),c.a.createElement("th",{scope:"col"},"Currency"),c.a.createElement("th",{scope:"col"},"Matter"))),c.a.createElement("tbody",null,c.a.createElement("tr",null,c.a.createElement("th",{scope:"row"},this.state.dates.issueDate),c.a.createElement("td",null,this.state.dates.dueDate),c.a.createElement("td",null,this.state.invoice.total),c.a.createElement("td",null,this.state.userData.account?this.state.userData.account.currencyFormat:"$"),c.a.createElement("td",null,this.state.invoice.matterDescription))))))),c.a.createElement(o.a,{style:{widht:"110%"}},c.a.createElement(o.a.Header,null,c.a.createElement(m.a,{type:"link",onClick:()=>{this.props.history.goBack()}},"Back to bills"))),c.a.createElement(o.a,null,c.a.createElement(o.a.Header,null,c.a.createElement("h4",null,"Select billable clients to generate new bills")),c.a.createElement(o.a.Footer,null,c.a.createElement(u.a,{className:"table-responsive",dataSource:this.state.tableData,columns:a}))),c.a.createElement(m.a,{type:"primary",onClick:()=>{d.a.destroy();let e=[];this.state.tableData.map((t,a)=>{this.state.selected[a]&&e.push(t)}),0==e.length?d.a.warning({message:"Please select a activity to bill"}):this.setState({visible:!0})}},"Generate"),c.a.createElement(h.a,{title:"Add details",visible:this.state.visible,onOk:v,onCancel:l,afterClose:l,footer:[c.a.createElement(m.a,{onClick:l},"Cancel"),c.a.createElement(m.a,{type:"primary",disabled:this.state.disable,onClick:v},"Submit")]},c.a.createElement(r.a,{id:"myForm",className:"form",ref:e=>this.messageForm=e},c.a.createElement(r.a.Group,{controlId:"issueDate"},c.a.createElement(r.a.Label,null,"Issue Date"),c.a.createElement(r.a.Control,{required:!0,type:"date",name:"issueDate",defaultValue:this.state.dates.issueDate,onChange:n})),c.a.createElement(r.a.Group,{controlId:"dueDate"},c.a.createElement(r.a.Label,null,"Due Date"),c.a.createElement(r.a.Control,{required:!0,type:"date",name:"dueDate",placeholder:"Select a date",onChange:n})))))}}t.default=Object(p.b)(e=>({userId:e.user.token.user._id}))(g)}}]);
//# sourceMappingURL=63.0d62269b.chunk.js.map