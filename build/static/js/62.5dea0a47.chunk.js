(this["webpackJsonpdatta-able-rv18.0.4"]=this["webpackJsonpdatta-able-rv18.0.4"]||[]).push([[62],{597:function(e,t,a){"use strict";a.r(t);var n=a(0),l=a.n(n),s=a(110),o=a(1001),r=a(989),c=a(268),i=a(999),d=a(973),m=a(728),p=a(3),u=a(8);let h=null,E={},g={};class y extends l.a.Component{constructor(e){super(e),this.state={data:{client:"",destination:"",paymentDate:"",source:"",userId:this.props.userId},clientId:"",clientData:"",tableData:[],unpaidBills:[],payment:[],total:0,fromTotal:!0,optionforAcoount:null,disabled:!1}}componentDidMount(){let e=null;p.b.get("/contact/viewforuser/"+this.props.userId).then(e=>{E=e.data.data,h=e.data.data.map((e,t)=>l.a.createElement("option",{id:t},e.firstName+" "+e.lastName))}).then(()=>{this.setState({options:h})}),p.b.get("/account/viewforuser/"+this.props.userId).then(t=>{console.log(t),g=t.data.data,e=t.data.data.map((e,t)=>l.a.createElement("option",{id:t},e.accountName))}).then(()=>{this.setState({optionforAcoount:e})})}render(){const e=e=>{e.persist();const t=e.target,a=t.id,n=t.value;let l=this.state;console.log(e.target),l.payment[a]=n,this.setState(l),console.log(this.state.payment)},t=t=>{t.persist();const a=t.target,n=a.name,s=(a.id,a.value);let o=this.state.data;"client"===n?(o[n]=E[t.target.selectedIndex],0!=t.target.selectedIndex?(this.setState({clientId:E[t.target.selectedIndex-1]._id}),console.log(E[t.target.selectedIndex-1]._id),p.b.get("/billing/bill/viewforcontact/"+this.props.userId+"/"+E[t.target.selectedIndex-1]._id).then(t=>{this.setState({clientData:t.data.data}),console.log(t.data.data),console.log("foo foo ");let a=[],n=[],s=[];t.data.data.map((t,o)=>{if("Unpaid"==t.status){let e=this.state.payment;e[o]=0,this.setState({payment:e,total:this.state.total+parseFloat(t.balance)})}const r={id:t._id,status:t.status,lastSeen:t.lastSeen?t.lastSeen:"--",dueDate:t.dueDate,invoiceID:t.invoiceId?t.invoiceId:"-",dueIn:t.dueDate.substring(0,10),matter:t.matter,openBalace:t.balance,issueDate:t.issueDate.substring(0,10),openBalance:t.balance,payment:l.a.createElement(i.a,null,l.a.createElement(d.a,null,l.a.createElement(m.a,{md:"10"},l.a.createElement(i.a.Group,{controlId:o},l.a.createElement(i.a.Control,{style:{height:"60%"},type:"text",key:o,name:"payment",placeholder:"$0.00",onChange:e})))))};"Paid"==t.status&&n.push(r),"Unpaid"==t.status&&s.push(r),a.push(r)}),this.setState({tableData:a,paidBills:n,unpaidBills:s})}).catch(e=>{console.log(e)})):this.setState({clientId:""})):o[n]=s,this.setState({data:o})},a=l.a.createElement("div",{style:{display:"flex","flex-wrap":"wrap"}},l.a.createElement("div",{className:"mr-4"},l.a.createElement("p",{style:{fontWeight:"bold"}},"Total open balance"),l.a.createElement("p",{style:{fontWeight:"bold",float:"right","font-size":"17px"}},"$",this.state.total.toFixed("2"))),l.a.createElement("div",null,l.a.createElement(i.a,{className:"pt-0"},l.a.createElement(d.a,null,l.a.createElement(m.a,{md:"8"},l.a.createElement(i.a.Group,{controlId:"paymentAmount"},l.a.createElement(i.a.Label,{style:{fontWeight:"bold"}},"Payment Amount"),l.a.createElement(i.a.Control,{style:{height:"38px"},required:!0,name:"paymentAmount",type:"text",onChange:e=>{e.persist();const t=e.target,a=(t.id,t.value);let n=this.state;console.log(e.target),n.payment[0]=a,this.setState(n),this.setState({fromTotal:!0}),console.log(this.state.payment)},placeholder:"0.00"}))))))),n=""===this.state.data.client?l.a.createElement("h4",{style:{textAlign:"center",fontWeight:"bold"}},"Select a client to record a payment."):a,u=""===this.state.data.client?null:l.a.createElement("div",null,l.a.createElement(o.a,{bodyStyle:{padding:"0px"},className:"overflow-auto"},l.a.createElement(r.a,{dataSource:this.state.unpaidBills,columns:[{title:"Invoice ID",dataIndex:"invoiceID",key:"invoiceID"},{title:"Matter",dataIndex:"matter",key:"matter"},{title:"Issue Date",dataIndex:"issueDate",key:"issueDate"},{title:"Due In",dataIndex:"dueIn",key:"dueIn"},{title:"Status",dataIndex:"status",key:"status"},{title:"Open Balance",dataIndex:"openBalance",key:"openBalance"},{title:"Payment",dataIndex:"payment",key:"payment"}]})));return l.a.createElement("div",null,l.a.createElement(o.a,{title:"Record Payment",bodyStyle:{padding:"0px 24px 0px"},className:"mb-4"},l.a.createElement(i.a,{className:"form-details"},l.a.createElement(d.a,null,l.a.createElement(m.a,{md:"3"},l.a.createElement(i.a.Group,{controlId:"formGroupCompany"},l.a.createElement(i.a.Label,null,"Client"),l.a.createElement(i.a.Control,{name:"client",as:"select",onChange:t},l.a.createElement("option",null,"Select a client"),this.state.options))),l.a.createElement(m.a,{md:"3"},l.a.createElement(i.a.Group,{controlId:"source"},l.a.createElement(i.a.Label,null,"Source"),l.a.createElement(i.a.Control,{name:"source",as:"select",onChange:t},l.a.createElement("option",null,"Select a Source"),l.a.createElement("option",null,"Card Payment"),l.a.createElement("option",null,"Cash Payment"),l.a.createElement("option",null,"Net Banking"),l.a.createElement("option",null,"Other"))))),l.a.createElement(d.a,null,l.a.createElement(m.a,{md:"3"},l.a.createElement(i.a.Group,{controlId:"date"},l.a.createElement(i.a.Label,null,"Payment Date"),l.a.createElement(i.a.Control,{type:"date",name:"paymentDate",onChange:t}))),l.a.createElement(m.a,{md:"3"},l.a.createElement(i.a.Group,{controlId:"destinaation"},l.a.createElement(i.a.Label,null,"Destination"),l.a.createElement(i.a.Control,{name:"destination",as:"select",onChange:t},l.a.createElement("option",null,"Select a Destination"),this.state.optionforAcoount)))),l.a.createElement(d.a,null,l.a.createElement(m.a,{md:"4"},l.a.createElement(i.a.Group,{controlId:"formGroupLastName"},l.a.createElement(i.a.Label,null,"Reference"),l.a.createElement(i.a.Control,{required:!0,name:"reference",type:"text",placeholder:"Enter a checking or reference # here",onChange:t})))))),l.a.createElement(o.a,null,n),u,l.a.createElement("div",{className:"pt-3"},l.a.createElement(c.a,{type:"primary",disabled:this.state.disabled,onClick:e=>{s.a.destroy(),""===this.state.data.client||"Select a client"===this.state.data.source?s.a.error({message:"Please select a client"}):""===this.state.data.source||"Select a Source"===this.state.data.source?s.a.error({message:"Please select a source"}):""===this.state.data.destination||"Select a Destination"===this.state.data.destination?s.a.error({message:"Please select a destination"}):""===this.state.data.paymentDate?s.a.error({message:"Please select a payment date"}):(this.setState({disabled:!0}),this.state.clientData.map((e,t)=>{const a=e;if(a.lastSeen=new Date,this.state.fromTotal){const e=this.state.payment[0];parseFloat(a.balance)-parseFloat(e)>0&&(a.balance=parseFloat(a.balance)-parseFloat(e))}else{const e=this.state.payment[t];a.balance=parseFloat(a.balance)-parseFloat(e)}console.log(a),p.b.post("/billing/bill/edit/"+e._id,a).then(e=>{console.log(e),this.setState({disabled:!1}),s.a.success({message:"Bill Recorded"})}).catch(e=>{console.log(e),this.setState({disabled:!1}),s.a.error({message:"Failure "})})}),p.b.post("/billing/create",this.state.data).then(e=>{console.log(e),this.props.history.goBack()}).catch(e=>{}))}},"Record"),l.a.createElement(c.a,{onClick:()=>{this.props.history.goBack()}},"Cancel")))}}t.default=Object(u.b)(e=>({userId:e.user.token.user._id}))(y)}}]);
//# sourceMappingURL=62.5dea0a47.chunk.js.map